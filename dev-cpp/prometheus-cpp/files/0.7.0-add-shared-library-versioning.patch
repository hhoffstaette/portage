From e3baf7a787a3eace57fc6ee7c588e789463133cd Mon Sep 17 00:00:00 2001
From: Gregor Jasny <gjasny@googlemail.com>
Date: Sat, 15 Dec 2018 15:03:56 +0100
Subject: [PATCH] Add (shared) library versioning

Closes: #223
---
 CMakeLists.txt      | 2 +-
 core/CMakeLists.txt | 7 ++++++-
 pull/CMakeLists.txt | 7 ++++++-
 push/CMakeLists.txt | 7 ++++++-
 4 files changed, 19 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 937a598..30acdf9 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,7 +1,7 @@
 
 cmake_minimum_required(VERSION 3.5 FATAL_ERROR)
 
-project(prometheus-cpp)
+project(prometheus-cpp VERSION 0.7.0)
 
 include(GNUInstallDirs)
 
diff --git a/core/CMakeLists.txt b/core/CMakeLists.txt
index 219cc82..3b21360 100644
--- a/core/CMakeLists.txt
+++ b/core/CMakeLists.txt
@@ -30,7 +30,12 @@ target_include_directories(core
     $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
 )
 
-set_target_properties(core PROPERTIES OUTPUT_NAME ${PROJECT_NAME}-core)
+set_target_properties(core
+  PROPERTIES
+    OUTPUT_NAME ${PROJECT_NAME}-core
+    VERSION "${PROJECT_VERSION}"
+    SOVERSION "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}"
+)
 
 install(
   TARGETS core
diff --git a/pull/CMakeLists.txt b/pull/CMakeLists.txt
index 337e21f..6ae827c 100644
--- a/pull/CMakeLists.txt
+++ b/pull/CMakeLists.txt
@@ -40,7 +40,12 @@ target_compile_definitions(pull
     $<$<BOOL:${ENABLE_COMPRESSION}>:HAVE_ZLIB>
 )
 
-set_target_properties(pull PROPERTIES OUTPUT_NAME ${PROJECT_NAME}-pull)
+set_target_properties(pull
+  PROPERTIES
+    OUTPUT_NAME ${PROJECT_NAME}-pull
+    VERSION "${PROJECT_VERSION}"
+    SOVERSION "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}"
+)
 
 install(
   TARGETS pull
diff --git a/push/CMakeLists.txt b/push/CMakeLists.txt
index 4e4002e..49344da 100644
--- a/push/CMakeLists.txt
+++ b/push/CMakeLists.txt
@@ -23,7 +23,12 @@ target_include_directories(push
     ${CURL_INCLUDE_DIRS}
 )
 
-set_target_properties(push PROPERTIES OUTPUT_NAME ${PROJECT_NAME}-push)
+set_target_properties(push
+  PROPERTIES
+    OUTPUT_NAME ${PROJECT_NAME}-push
+    VERSION "${PROJECT_VERSION}"
+    SOVERSION "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}"
+)
 
 install(
   TARGETS push
